{"version":3,"file":"internal-property-validator.js","sourceRoot":"","sources":["../src/internal-property-validator.ts"],"names":[],"mappings":"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","sourcesContent":["import { PropertyValidator } from \"./property-validator\";\nimport { InternalPropertyValidationRule } from \"./internal-property-validation-rule\";\nimport { ValidationRule } from \"./validation-rule\";\nimport { Validator } from \"./validator\";\nimport { given } from \"n-defensive\";\nimport { ApplicationException } from \"n-exception\";\nimport \"n-ext\";\n\n// internal\nexport class InternalPropertyValidator<T, TProperty> implements PropertyValidator<T, TProperty>\n{\n    private readonly _propertyName: string;\n    private _hasError: boolean;\n    private _error: any;\n    private readonly _validationRules = new Array<InternalPropertyValidationRule<T, TProperty>>();\n    private _lastValidationRule: InternalPropertyValidationRule<T, TProperty>;\n\n\n    public get propertyName(): string { return this._propertyName; }\n    public get hasError(): boolean { return this._hasError; }\n    public get error(): string { return this._error; }\n\n\n    public constructor(propertyName: string)\n    {\n        this._propertyName = propertyName;\n    }\n\n\n    public validate(value: T): void\n    {\n        this._hasError = false;\n        this._error = null;\n\n        let val = <T>value;\n        let propertyVal = (<Object>val).getValue(this._propertyName);\n\n\n        for (let i = 0; i < this._validationRules.length; i++)\n        {\n            let validationRule = this._validationRules[i];\n            let validationResult = true;\n\n            try\n            {\n                validationResult = validationRule.validate(val, propertyVal);\n            } catch (e)\n            {\n                if (e === \"OPTIONAL\")\n                    break;\n\n                throw e;\n            }\n\n            if (!validationResult)\n            {\n                this._hasError = true;\n                this._error = validationRule.error;\n                break;\n            }\n        }\n    }\n\n    public isRequired(): PropertyValidator<T, TProperty>\n    {\n        this._lastValidationRule = new InternalPropertyValidationRule<T, TProperty>();\n        this._lastValidationRule.ensure((propertyValue: TProperty) =>\n        {\n            if (propertyValue != null)\n            {\n                if ((typeof propertyValue) === \"string\")\n                {\n                    return !(<string>(<any>propertyValue)).isEmptyOrWhiteSpace();\n                }\n                return true;\n            }\n            return false;\n        });\n\n        this._lastValidationRule.withMessage(\"Required\");\n        this._validationRules.push(this._lastValidationRule);\n        return this;\n    }\n\n    public isOptional(): PropertyValidator<T, TProperty>\n    {\n        this._lastValidationRule = new InternalPropertyValidationRule<T, TProperty>();\n        this._lastValidationRule.ensure((propertyValue: TProperty) =>\n        {\n            if (propertyValue == null)\n                throw \"OPTIONAL\";\n\n            if ((typeof propertyValue) === \"string\" && (<string>(<any>propertyValue)).isEmptyOrWhiteSpace())\n                throw \"OPTIONAL\";\n\n            return true;\n        });\n\n        this._validationRules.push(this._lastValidationRule);\n        return this;\n    }\n\n    public ensure(propertyValidationPredicate: (propertyValue: TProperty) => boolean): PropertyValidator<T, TProperty>\n    {\n        this._lastValidationRule = new InternalPropertyValidationRule<T, TProperty>();\n        this._lastValidationRule.ensure(propertyValidationPredicate);\n        this._validationRules.push(this._lastValidationRule);\n        return this;\n    }\n\n    public ensureT(valueValidationPredicate: (value: T) => boolean): PropertyValidator<T, TProperty>\n    {\n        this._lastValidationRule = new InternalPropertyValidationRule<T, TProperty>();\n        this._lastValidationRule.ensureT(valueValidationPredicate);\n        this._validationRules.push(this._lastValidationRule);\n        return this;\n    }\n\n    public useValidationRule(validationRule: ValidationRule<TProperty>): PropertyValidator<T, TProperty>\n    {\n        this._lastValidationRule = new InternalPropertyValidationRule<T, TProperty>();\n        this._lastValidationRule.useValidationRule(validationRule);\n        this._validationRules.push(this._lastValidationRule);\n        return this;\n    }\n\n    public useValidator(validator: Validator<TProperty>): PropertyValidator<T, TProperty>\n    {\n        this._lastValidationRule = new InternalPropertyValidationRule<T, TProperty>();\n        this._lastValidationRule.useValidator(validator);\n        this._validationRules.push(this._lastValidationRule);\n        return this;\n    }\n\n    public if(conditionPredicate: (value: T) => boolean): PropertyValidator<T, TProperty>\n    {\n        given(conditionPredicate, \"conditionPredicate\").ensureHasValue();\n\n        if (this._lastValidationRule == null)\n            throw new ApplicationException(\"No target Validation Rule specified for the condition.\");\n\n        this._lastValidationRule.if(conditionPredicate);\n\n        return this;\n    }\n\n    public withMessage(errorMessage: string): PropertyValidator<T, TProperty>\n    {\n        given(errorMessage, \"errorMessage\").ensureHasValue();\n\n        if (this._lastValidationRule == null)\n            throw new ApplicationException(\"No target Validation Rule specified for the condition.\");\n\n        this._lastValidationRule.withMessage(errorMessage);\n\n        return this;\n    }\n}"]}